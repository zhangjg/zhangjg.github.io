---
title: R 语言笔记(4)
layout: default
tags: [编程,读书]
---
# 對象#
R語言中一切都是對象,可是通過typeof(o)函數,來獲得一個對象的名字.typeof()函數可能的返回值
有:

<table>
<thead><th>名稱<th>意義
<tr><td>"NULL"        <td>NULL
<tr><td>"symbole"     <td>變量名
<tr><td>"pairlist"    <td>一個pairlist對象(主要是內部使用)
<tr><td>"closure"     <td>一個函數
<tr><td>"environment" <td>一個環境
<tr><td>"promise"     <td>一個用來實現惰性計算的對象
<tr><td>"language"    <td>一個R語言的結構
<tr><td>"special"     <td>一個不計算他的參數的內部函數
<tr><td>"builtin"     <td>一個計算其參數的內部函數
<tr><td>"char"        <td>一個"標量"字符串對象(只在內部使用)***
<tr><td>"logical"     <td>一個值為邏輯值的向量
<tr><td>"integer"     <td>一個包含整數值的向量
<tr><td>"double"      <td>一個包含了實數值的向量
<tr><td>"complex"     <td>一個複數向量
<tr><td>"character"   <td>字符串向量
<tr><td>"..."         <td>一個特殊的變長參數***
<tr><td>"any"         <td>一個可以匹配所有類型的特殊類型:沒有對象是這種類型.
<tr><td>"expression"  <td>一個表達式對象
<tr><td>"list"        <td>一個列表對象
<tr><td>"bytecode"    <td>一個字節碼對象(只在內部使用)***
<tr><td>"externalptr" <td>一個外部指針對象
<tr><td>"weakref"     <td>一個弱引用對象
<tr><td>"raw"         <td>一個字節碼向量
<tr><td>"S4"          <td>一個不是簡單對象的S4對象
</table>

注释中标注为\*\*\*的项目都是不容易在解释代码中看到的对象.

## 向量##
向量被認為是包含數據的連續空間.向量有一下幾種,他們的type,mode和storage.mode如下表:

<table>
<thead>
<th>typeof(x)<th>mode(x)<th>storage.mode(x)
<tr> <td>logical   <td> logical<td>logical
<tr> <td>integer   <td> numberic  <td> integer
<tr> <td>double    <td> numberic  <td> double
<tr> <td>complex   <td> complex   <td> complex
<tr> <td>character <td> character <td> character
<tr> <td>raw       <td> raw       <td> raw
</table>

單獨的數字,例如4.2也還是向量,長度為1的向量.可有0長度的向量.
## list##
列表可以看做是一個泛型向量,它的元素可以是任何類型的R對象.而且元素的類型還可以不同.列表對象
可以通過三種不同的方法來索引其中的數據.

與其他語言相比,R中的list對象,和PHP中的數組最為相似.對象的元素可以是任意的類型,同時還可以給元素
一個名字,也就是存放key-value對.檢索對象的時候,既可以通過index下標來檢索,如果有key的話,也可以通
過key來檢索.但是還是有不同處,在PHP中如果用下標來索引的話,第一個沒有key的值的下標是0,然後一次的
增加,有key的元素的key值不能通過數字來索引到.但是R中可以.下面的代碼表示了其中的不同.

```R
listd <- list(name="Tom",age=20,"Hello word")
print(listd[0]);
print(listd$name);
```
輸出是:
```txt
$name
[1] "Tom"
[2] "Tom"
```

```PHP
$data_array = array(name=>"Tom",age=>20,"Hello world");
print($data_array[0]) #Hello world"
print($data_array.name) #Hello world
```
list中的下標從1開始,PHP和C,Java,Python等等其他語言中是從0開始的,這是一個不同;另外一個不同是其
他語言中使用"."來引用一個對象的成員(分量),list中使用"$"符號.


## 語言對象##
有3種對象構成了R語言:*調用(call),表達式(expression)和名字(name)* .它們可以通過quote()機制
直接創建或者通過as.list() 和 as.call()函數轉化得到.
## 符號對象##
任何R對象的名字通常都是一個符號,符號可以通過as.name()和quote() 來創建.一個符號的類型是
symbole,mode是name,storage.mode是symbole.符號變量可以和字符串通過as.character()和
as.name相互轉化.
## 表達式對象##
表達式對象包含一個或多個語句,語句是語法正確的符號集合.表達式對象是特殊的語言對象,它包含了
解析過的,但是還沒有計算的R語句.主要的不同是表達式對象可以包含多個這樣的表達式,另外一個微妙
的區別是,表達式對象,只有在顯示的傳遞給eval()函數的時候才被計算,而其他的語言對象可以在一些
其他的情況下已經被計算了.

表達式是對象很像一個list,它的元素也像list中的元素那樣來訪問.
## 函數對象##
在R中,可以其他對象一樣來擺佈函數.函數對象有三個部分:*形式參數,函數體和環境.*

1. 形式參數放在函數定義的參數列表中,用逗號","分隔的不同的符號或者"sybomle=default"和特
殊的不定長參數"...".其中第二種形式在函數被效用的時候,如果沒有給定形式參數的值,就會使用定
義時的默認值來作為參數的值."..."一般用來兩種情況,第一是參數的個數不確定,第二時參數要被傳
遞給其他的函數.
2. 函數體是被解析的R語句.通常是在大括號中的語句集合,也可以只是一個單獨的語句,符號,甚至一
個常數.
3. 函數的環境,是一個在函數被創建的時候有效的環境.在這個環境中綁定的任何的符號都被捕獲,都可
以在函數中使用.函數的代碼和他綁定的環境合在一起,叫做函數閉包.
通過formals,body,和 environment函數可以提取和維護一個閉包對象的三個部分.這三個部分也可
以用來給其他變量賦值.

當函數被調用的時候一個新的環境被創建.這個新的環境的閉包,是函數的閉包的環境.新的環境使用函
數的為計算的參數初始話填充.作為一個計算過程,本地變量在其中被計算.
## NULL##
NULL對象用來表示一個對象不存在。需要注意的是，NULL對象和零長度的數組對象不一樣。NULL對象
沒有類型也沒有可以修改的屬性。在R語言中只有一個NULL對象，所有的NULL對象都是對他的引用。通
過函數is.null(o),來判斷一個對象是不是NULL對象。
## 內部對象和特殊形式##
這兩種對象包含了R內建的函數。他們是作爲.Primitive在代碼列表中顯示的對象,以及通過.Internal
函數訪問的並且用戶不可見的對象。它們之間的不同在於對參數的處理的不同。內建對象總是計算參數
並把參數通過值傳遞給內建函數。特殊形式把未計算參數的傳遞給內建函數。通過is.primitive(x)函
數可以把這兩個對象和其他對象區分開。
## Promise 對象##
Promise對象是R的惰性求值機制的一部分。函數實參數都是promise對象，但是在R的代碼中無法判斷一
個對象是不是promise對象。
### 點點點對象##
"..."對象是一個對列表（Pairlist）對象。在R代碼中要訪問...對象的內容，可以先把它轉行成一個
list對象，然後再訪問list對象：
```R
test <- function(...)
{
    args<-list(...)
    for(item in args)
    {
        print(item)
    }
}
```
### 環境對象###
環境對象可以認爲有兩種東西組成的：一個框架，符號-值對的集合；和一個閉包，一個指向封閉環
境的指針。當R尋找一個符號的值的時候，框架會被檢查，如果找到了符號的值，那麼返回這個值，
如果沒有找到這個值，封閉的環境被訪問，相同的過程被重復。環境變量形成一個樹結構，封閉的
環境扮演了父節點。環境對象在函數調用的時候，隱式的被調用。在函數調用的時候，環境包含了
這個函數的本地變量（包括參數），他的閉包是調用函數的環境。環境也可以直接通過new.env()來
創建。parent.env函數可以用來獲取一個環境對象的閉包。
### 對列表對象###
對列表對象想LISP中的點對列表.對列表對象在R內部廣泛的使用,但是在解釋性R代碼中很少看到.在解釋
性R語言中,可以通過formals()來獲取或通過 pairlist()函數創建一個對列表對象.零長度的對列表對
象是NULL,和零长度的列表對象不一樣.

對列表對象有三個槽:*CAR,CDR,TAR.* TAR是一個文本字符串,CAR和CDR分別是列表的頭和尾.在R語言
中處理對列表對象和處理列表對象一樣.元素通過[[]]來訪問.對列表對象一般不推薦使用,因為列表對象
效率更高.當一個內部的對列表對象需要訪問的時候,一般把它轉化成列表,然後在訪問.
### Any對象###
一個對象不是真的可能是一個Any類型的對象.但是它還是一個合法的類型值.它在特殊的情況下被使用,
例如:`as.vector(x,"any")`來表示這個強制轉化不應該被做.

## 屬性##
除了NULL對象,其他的對象都可以有屬性.可以通過attributes(x)來獲取x對象的屬性,通過
attributes(x,name)<- 來為x的name屬性設置值.attr(x)和attr(x)<-在R的一致性機制的保證性,
完成和attributes(x)和attributes(x,name)<-同樣的工作.屬性被存儲在對列表中,可以認為是
"名-值"對.

矩陣和數組是有dim和可選的dimname屬性的向量.

在R中class屬性還用來實現一個類結構.如果一個對象有class屬性,在對這個對象計算的時候將堅持這
個屬性值.
### 名字###
names屬性如果出現的話,用來標記一個向量或列表的單獨的元素.當一個對象被打印的時候,如果names
屬性存在,那麼這個屬性值將用來標記這個對象.名字屬性還可以用來做檢索.
可以通過names(x)和names(x)<-來獲取和設置x對象的名字屬性.

對於一維數組,names(x)屬性實際上對dimnames[[1]]做操作.
### 維度###
dim屬性用來實現一個數組.數組的內容以列順序優先的存放在向量中.dim屬性是一個整數向量,用來表
示數組的內容.R確保了向量的長度是緯度向量內容的乘積.

向量和數組是不一樣的,因為後者有一個dim為1的屬性,而前者沒有.

### dimnames 屬性###
數組可以通過dimnames屬性來為數組的每個維度都命名.dimnames 屬性是一個字符串向量列表.
dimnames自己的名字在打印的數組的時候會被作為內容的標題來使用.
### 類屬性###
R是通過class屬性控制的,一個精巧的類系統.這個屬性是一個字符串向量,包含了這個對象繼承的對象.
這形成了R語言中"一般方法"的基礎.用戶並不限制去訪問和修改這個屬性.也不檢查對象是否還有一個方
法實際需要的組件.

### 時間序列屬性###
tsq屬性用來記錄時間序列參數,開始,結束,以及頻率等等.這個屬性主要用來處理週期性序列的子結構,
例如月份,或季度的數據.

## 特殊組分對象##
### 因子對象###
因子factor對象元素的值是个数有限的,例如性別,社會關係等等.因子對象有一個屬性leave和class
"factor".有一個可選的屬性constractor當這個因子對象用在模型函數的時候用來控制參數.

一個因子可以是自然的排列或者是排序的因子,排序因子的class是c("ordered","factor").

一個因子對象,可以看作是是個元素值為枚舉對象的向量.因子的leave,就是一個枚舉值可能取的所有的
枚舉值.當然,可以有枚舉值不出現在元素的值中.

### 數據框架對象###
數據框架對象是一個列表對象,其中的元素是向量,因子,和或矩陣.其中元素的長度一樣(對矩陣來說是行
數一樣).一般來說data frame 對象有一個names屬性用來標記變量.row.names屬性用來標記一個特
例(case).數據框架對象可以包含一個和其他組分長度一樣的列表.這個列表的元素可以是不同長度的數
據,作為一個不整齊的數組.
