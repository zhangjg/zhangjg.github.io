---
title : 编程语言中的特别设计
layout: default
tags: [编程]
---
# 编程语言中的特别设计 #

每种编程语言都是被精心设计的，它提供的各种语言特性，都有其特殊的作用和意义，但是很多时候，在我们学习或者使用这些语言的时候，却未必意识到了当初设计者的用心。今天我就自己熟悉的几种编程语言，谈谈我意识到的它们的设计者的几点良苦用心。

## 1.和C/C++相比，Java，Javascript等为啥没有sizeof关键字 ##
可能在使用Java，Javascript的时候，你都不会意思到，其实它没有sizeof关键字，这就是为什么这些语言不把它作为关键字的原因--- ---不需要。那么问题就变成了，为什么C/C++需要sizeof？这里的原因有两个，1) C/C++让程序自己可以分配堆空间的内存，为了计算需要分配的内存的大小，所以需要这样的一个关键字。2)C/C++的不同的实现对同样的类型可能定义不同的内存大小，例如int在32位的机器上是32位的，在64位的机器上是64位的。通过sizeof关键字，在为int分配内存大小的时候，可以写出和机器无关的代码，增强了代码的可移植性。如果这两个条中有一条不满足，那么其实就可以不用提供这个关键字的。现代的编程语言，基本上都不会有这两个问题了。对第一个问题，是提过了垃圾回收来解决，对第二个问题在语言设计的时候就明确的定义了不同的数据的内存表示需要的字节长度。所以sizeof关键字就成了C/C++的特色关键字。

## 2.为什么C/C++，Objective-C有头文件，而其他的一般没有头文件？ ##
首先，我们需要搞清楚头文件的作用是什么。C/C++、Objective-C这些语言中的头文件是实现文件的接口说明文件。把实现和头文件分开，一个函数的使用者（调用者）在不需要知道函数的实现细节，就可以正确的调用函数。这样，减少了出错的可能性。试想你有一个实现文件，其中有10000行的代码，其中有n个函数，但是我只关心其中的一个函数的原型,看看这个函数的需要哪些参数,从10000行代码中找到函数的定义的地方，这对我的眼睛要造成多大的压力。相反，定义了头文件，我就可以很轻松的从头文件中把函数的定义原型找到。因为头文件中记录的只是函数的声明，所以其中的代码行数自然要比实现文件少的多。这是从程序员的角度考虑问题，从语言设计的角度来看，C/C++和Objective-C,对于类型,变量的使用都遵循先声明后使用的原则,编译器对源文件的处理，需要经过预处理,编译，和链接三个步骤。其中头文件是在预处理的时候使用的.预处理程序遇到include指令的时候,把头文件中的内容,添加到实现文件中,这样,在实现文件中就有了函数和结构的定义,也就满足了C/C++,Objective-C的先声明后使用的规定.编译就是把源文件(包括其中include指令,包含近来的头文件的内容),生成机器目标代码.因此,要通过编译，只需要提供必要的头文件就可以了。但是代码要真正的能够执行，必须要把这个程序需要的实现代码都链接到一起才行。链接需要程序的实现代码。
现在我们想想为什么Java不需要头文件？当Java源文件被编译之后，Java类的类元信息(包括,这个类的名字,他的父类的名字,他包含的(以及从父类继承来的)数据字段,方法等等内容)统统都编译到class文件中了。举个例子来说明，如果A是编译好的一个Java类，现在我写了一个新的类B，其中用到了类A，在我编译B的时候，只要我有A的class文件，因为A的class文件中包含有A类的所有的类元信息，编译器根据A的class文件就有足够的信息来编译类B了，所以可以不用类A 的源文件。（C/C++不可以这样作，因为C/C++要求在使用对象之前需要先声明，因此没有头文件是不可以编译的,这也就是为什么在linux下有些库会分为开发版和非开发版的区别,开发版比一般的使用版多了头文件）。就是说Java的编译器在类A的class中能读取他需要的信息用于编译B类，而C++的编译器则不这么做。那么Java中是如何解决接口的说明问题的呢？Java的接口说明，是通过Java doc来提供的，为了产生Java doc，Java特意引入了文档注释。然后使用java doc来处理文件件生成java doc文档用来作程序原之间的接口文档。
其他的高级语言,比如Python也提供了注释文档.而且语言自身的元编程能力,可以更容易的访问到这些注释文档.所以Python程序,如果IDE做的足够好,或者IDE做的不好,但是你对语言本身足够了解,不看源代码,也一样能看到其中的注释.我想这就是为什么Python连文档生成的功能都不额外提供的原因.当然了,用Python自己处理自己的源码,提取其中的注释生成文档,也不是什么困难的事情.这可能也是Ptyhon不提供DOC生成工具的原因.
对于Javascript,最初设计的时候本没有打算让程序要用这个怨言处理复杂的问题，对于简单的问题，与其用自然语言描述还不如计算机程序来的准确，因此脚本语言的Javascript没有什么接口文件。或者说接口文件就是源代码本身。和Python相比,Javascript目前还没有获取语言中注释代码的能力.或者说Javascript没有Python中对应的说明文档字符串对应的内容.
上面我们看到了1)通过头文件来提供API的方法,2)通过API DOC文档来提供API的方法,3)通过源码来查看API,这3种解决方案.那种好呢？
使用源代码本身作为接口，这个方案是最不好的，尤其是当代码复杂的时候。而且使用源代码本身作为接口，就意味着必须把源代码开放给其他人，这从积极的方面来说促进了开源运动的发展。但是从商业利益的角度考虑，这种模式是无法保护自己的商业利益的。
头文件的解决方案和从源文件的注释中生成API文档的方法旗鼓相当，但是从排版的美观，易于阅读等方面来说，生成的HTML格式的API要比手动书写的文本格式要好很多。  
Java的文档注释代码需要的规则还是比较复杂的,这些规则大部分是借鉴原来在C/C++中的注释惯例来定的.对与不熟悉C/C++的人来说,也就无所谓惯例了,所以当年通过perl来生成C/C++ 文档的惯例对Java程序员来说就变得复杂起来.要生成自己想要的漂亮的doc文档,就需要自己去学习比较复杂的那一套规则.最近轻量级的标记语言兴起,比如markdown,reStructedText,等等.所以,新的编程语言的文档注释内容会采用轻量标记语言,例如,在Ptyhon的程序说明文档中,用Markdown的语法来写注释,那么就可以很容易的生成API文档.

## 3.为什么有些语言的开发效率比别的语言高? ##
熟悉多种不同编程语言的人,会有一个体会,不同的语言的开发效率是不一样的.比如,C++要比C写程序要快,Java有比C++快.Python比其他的又快.现在用Node.js来写程序,Javascript的开发效率也不必Python慢.不同的人各自会有自己的体验,体验有不同的差距,但是不同的语言,实现相同的功能,程序员要写的代码的行数,多少的确是不同的.那么是什么原因,让同样是通用的编程语言,在开发效率上有了差距呢?
我觉的,第一个原因可能是库.一个语言提供的标准库足够强大的话,程序员自己需要写的代码自然就少了.但是这不是根本的原因.或者是不是主要的原因.那主要的原因是什么呢?我觉得主要的原因是一个语言本身是不是足够灵活来表示程序员需要的结构.对C/C++,Object-c这些语言来说,程序员想要用自己的结构,必须提前想要结构的内容,一旦结构的需要变动,在程序使用的时候,不能随意的添加新的字段.虽然可以通过各种方法来扩展,但是不是那么的方便,但是如果使用动态语言就一样了.一个对象可以在任何时候添加或减少其中的元素.我觉得这是最重要的原因.可不可以方便的在源代码中表示自己想要的结构,是一个语言生产效率的重要标志.Java,C++,C,以及Object-c其实都不能使用字面量来表示一个复杂的结构的.而且已经构建的结构也不能对其动态的做修改.Javascript,python,lua等等在一定程度上可以构建自己的对象,最重要的就是**字典或者说map,对象的字面表达**,大大的提高的他们的开发效率.我自己的体会,能不能通过字面量来表达一个复杂的结构,对于一个语言的开发效率,这重要的影响.回忆以下C/C++,它支持对一个结构的一定程度的字面量表达,也就是结构的所谓的指定字段初始化.

```C
struct Test{
int age;
char name[10];
};
struct Test t={.name:"hello",.age:10};
```

但是这种支持和Python,Javascript等动态语言相比还是差的太远.因为我们在对Test进行初始化的时候,必须还首先定义好他的结构.在动态语言中,我们可以根据自己对功能的不断的深入理解,来动态的添加字段,在C/C++/Object-C中,就必须在定义文件中添加内容了.
